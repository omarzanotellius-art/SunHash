<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>SunHash — Risk Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --bg:      #E4E4E0;
  --black:   #111111;
  --yellow:  #DDFF00;
  --white:   #F0F0EC;
  --gray-lt: #D4D4D0;
  --gray:    #B8B8B4;
  --gray-dk: #888884;
  --red:     #E83535;
  --fh: 'Barlow Condensed', sans-serif;
  --fb: 'Barlow', sans-serif;
  --bk: 2px solid #111111;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{font-family:var(--fb);background:var(--bg);color:var(--black);min-height:100vh;-webkit-font-smoothing:antialiased;}

/* ── SCREENS: shown/hidden via JS after DOM ready ── */
.screen { display: none; }
.screen.visible { display: block; }

/* ── TOPBAR ── */
.topbar{height:56px;background:var(--black);display:flex;align-items:center;justify-content:space-between;padding:0 40px;border-bottom:3px solid var(--yellow);}
.logo{font-family:var(--fh);font-size:24px;font-weight:900;letter-spacing:2px;text-transform:uppercase;color:var(--white);}
.logo span{color:var(--yellow);}
.topbar-tag{font-family:var(--fh);font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#555;}

/* ── AUTH HERO ── */
.auth-hero{background:var(--black);padding:56px 40px 48px;display:flex;align-items:flex-end;justify-content:space-between;gap:40px;flex-wrap:wrap;}
.auth-hero h1{font-family:var(--fh);font-size:clamp(36px,5vw,66px);font-weight:900;text-transform:uppercase;line-height:1.0;color:var(--white);letter-spacing:-1px;max-width:600px;margin-bottom:14px;}
.auth-hero h1 em{color:var(--yellow);font-style:normal;display:block;}
.auth-hero p{font-size:15px;color:rgba(255,255,255,.45);max-width:480px;line-height:1.6;}
.score-strip{display:flex;gap:8px;flex-wrap:wrap;}
.score-chip{width:72px;border:var(--bk);display:flex;flex-direction:column;align-items:center;padding:12px 8px;background:#1E1E1E;flex-shrink:0;}
.score-chip .val{font-family:var(--fh);font-size:28px;font-weight:900;color:var(--white);line-height:1;}
.score-chip .lbl{font-family:var(--fh);font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:#666;margin-top:4px;}
.score-chip.hi .val{color:var(--yellow);}
.score-chip.lo .val{color:var(--red);}

/* ── AUTH BODY ── */
.auth-body{display:grid;grid-template-columns:1fr 1fr;border-top:var(--bk);}
@media(max-width:768px){.auth-body{grid-template-columns:1fr;}}
.auth-left{background:var(--white);border-right:var(--bk);padding:40px;}
.auth-right{background:var(--bg);padding:40px;}
@media(max-width:768px){.auth-right{display:none;}}

/* ── TABS ── */
.tab-row{display:flex;border:var(--bk);margin-bottom:28px;}
.tab-btn{flex:1;padding:12px;border:none;background:var(--bg);color:var(--gray-dk);font-family:var(--fh);font-size:14px;font-weight:800;letter-spacing:2px;text-transform:uppercase;cursor:pointer;}
.tab-btn.active{background:var(--black);color:var(--yellow);}

/* ── FIELDS ── */
.field{margin-bottom:18px;}
.field label{display:block;font-family:var(--fh);font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--gray-dk);margin-bottom:7px;}
.field input,.field select{width:100%;padding:11px 14px;background:var(--bg);border:var(--bk);font-family:var(--fb);font-size:15px;color:var(--black);outline:none;}
.field input::placeholder{color:var(--gray);}
.field input:focus,.field select:focus{box-shadow:3px 3px 0 var(--yellow);}

/* ── BUTTONS ── */
.btn-google{width:100%;padding:13px;background:var(--white);border:var(--bk);font-family:var(--fh);font-size:14px;font-weight:800;letter-spacing:2px;text-transform:uppercase;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:20px;}
.btn-google:hover{background:var(--black);color:var(--white);}
.btn-google svg{width:18px;height:18px;flex-shrink:0;}
.or-row{text-align:center;font-family:var(--fh);font-size:12px;font-weight:700;letter-spacing:2px;color:var(--gray);margin:0 0 20px;}
.btn-primary{width:100%;padding:15px;background:var(--black);border:var(--bk);color:var(--yellow);font-family:var(--fh);font-size:16px;font-weight:900;letter-spacing:3px;text-transform:uppercase;cursor:pointer;margin-top:4px;}
.btn-primary:hover{background:var(--yellow);color:var(--black);}
.btn-primary:disabled{opacity:.4;cursor:not-allowed;}
.msg{min-height:20px;margin-top:12px;font-size:13px;font-weight:600;}
.msg.err{color:var(--red);}
.msg.ok{color:#22883a;}
.link-sm{font-size:13px;color:var(--gray-dk);text-decoration:underline;cursor:pointer;background:none;border:none;padding:0;margin-top:14px;display:block;text-align:center;}

/* ── HOW IT WORKS ── */
.panel-tag{font-family:var(--fh);font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--yellow);background:var(--black);display:inline-block;padding:4px 10px;margin-bottom:16px;}
.panel-title{font-family:var(--fh);font-size:28px;font-weight:900;text-transform:uppercase;letter-spacing:-1px;margin-bottom:28px;}
.how-step{display:flex;gap:20px;padding:20px 0;border-bottom:var(--bk);}
.how-step:last-child{border-bottom:none;}
.how-num{font-family:var(--fh);font-size:32px;font-weight:900;color:var(--yellow);line-height:1;flex-shrink:0;width:44px;}
.how-text h4{font-family:var(--fh);font-size:16px;font-weight:800;text-transform:uppercase;letter-spacing:1px;margin-bottom:5px;}
.how-text p{font-size:13px;color:var(--gray-dk);line-height:1.6;}

/* ── ONBOARDING ── */
#screen-onboard{background:var(--bg);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:60px 20px;}
.ob-wrap{width:100%;max-width:520px;}
.ob-logo{font-family:var(--fh);font-size:26px;font-weight:900;letter-spacing:2px;text-transform:uppercase;text-align:center;margin-bottom:32px;}
.ob-logo span{color:var(--yellow);}
.ob-header{margin-bottom:24px;}
.ob-step{font-family:var(--fh);font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--gray-dk);margin-bottom:8px;}
.ob-header h2{font-family:var(--fh);font-size:32px;font-weight:900;text-transform:uppercase;letter-spacing:-1px;}
.ob-header p{font-size:14px;color:var(--gray-dk);margin-top:6px;}
.ob-card{background:var(--white);border:var(--bk);padding:32px;}
.ob-note{font-size:12px;color:var(--gray-dk);text-align:center;margin-top:16px;}
</style>
</head>
<body>

<!-- ══ SCREEN: AUTH (visible by default via JS) ══ -->
<div id="screen-auth" class="screen">
  <div class="topbar">
    <div class="logo">Sun<span>Hash</span></div>
    <div class="topbar-tag">Risk Intelligence Platform</div>
  </div>
  <div class="auth-hero">
    <div>
      <h1>Pre-construction<em>risk intelligence</em>for solar developers</h1>
      <p>Structured AI-powered risk assessment across six categories. Receive a scored report in minutes.</p>
    </div>
    <div class="score-strip">
      <div class="score-chip hi"><span class="val">91</span><span class="lbl">Design</span></div>
      <div class="score-chip"><span class="val">72</span><span class="lbl">Construct</span></div>
      <div class="score-chip lo"><span class="val">44</span><span class="lbl">Contract</span></div>
      <div class="score-chip"><span class="val">68</span><span class="lbl">Grid</span></div>
      <div class="score-chip hi"><span class="val">85</span><span class="lbl">Permit</span></div>
      <div class="score-chip lo"><span class="val">55</span><span class="lbl">Finance</span></div>
    </div>
  </div>
  <div class="auth-body">
    <div class="auth-left">
      <div class="tab-row">
        <button class="tab-btn active" id="tab-li" onclick="switchTab('login')">Sign In</button>
        <button class="tab-btn" id="tab-su" onclick="switchTab('signup')">Create Account</button>
      </div>

      <!-- LOGIN -->
      <div id="form-login">
        <button class="btn-google" onclick="authGoogle()">
          <svg viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
          Continue with Google
        </button>
        <div class="or-row">OR</div>
        <div class="field"><label>Email</label><input type="email" id="li-email" placeholder="you@company.com"/></div>
        <div class="field"><label>Password</label><input type="password" id="li-pw" placeholder="••••••••"/></div>
        <button class="btn-primary" id="btn-li" onclick="doLogin()">Sign In →</button>
        <div class="msg" id="li-msg"></div>
        <button class="link-sm" onclick="switchTab('reset')">Forgot password?</button>
      </div>

      <!-- SIGN UP -->
      <div id="form-signup" style="display:none;">
        <button class="btn-google" onclick="authGoogle()">
          <svg viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
          Continue with Google
        </button>
        <div class="or-row">OR</div>
        <div class="field"><label>Email</label><input type="email" id="su-email" placeholder="you@company.com"/></div>
        <div class="field"><label>Password <span style="font-weight:400;letter-spacing:0;text-transform:none;">(min. 8 characters)</span></label><input type="password" id="su-pw" placeholder="••••••••"/></div>
        <button class="btn-primary" id="btn-su" onclick="doSignup()">Create Account →</button>
        <div class="msg" id="su-msg"></div>
      </div>

      <!-- RESET -->
      <div id="form-reset" style="display:none;">
        <p style="font-size:14px;color:var(--gray-dk);line-height:1.6;margin-bottom:20px;">Enter your email and we'll send a reset link.</p>
        <div class="field"><label>Email</label><input type="email" id="rs-email" placeholder="you@company.com"/></div>
        <button class="btn-primary" onclick="doReset()">Send Reset Link →</button>
        <div class="msg" id="rs-msg"></div>
        <button class="link-sm" onclick="switchTab('login')">← Back to sign in</button>
      </div>
    </div>

    <div class="auth-right">
      <div class="panel-tag">How it works</div>
      <div class="panel-title">Four steps to your risk report</div>
      <div class="how-step"><div class="how-num">01</div><div class="how-text"><h4>Project intake</h4><p>Define your project type, size, stage, and procurement model.</p></div></div>
      <div class="how-step"><div class="how-num">02</div><div class="how-text"><h4>Answer or upload</h4><p>Work through structured questions or upload your geotech report, design basis, or EPC offer. The AI extracts what it can and asks only for the gaps.</p></div></div>
      <div class="how-step"><div class="how-num">03</div><div class="how-text"><h4>Receive your scored report</h4><p>A PDF with six category scores, critical issues, action plan, and data gaps — within minutes.</p></div></div>
      <div class="how-step"><div class="how-num">04</div><div class="how-text"><h4>Enrich with specialists</h4><p>Invite your EPC, engineer, or counsel to fill their sections. Each response updates your score.</p></div></div>
    </div>
  </div>
</div>

<!-- ══ SCREEN: ONBOARDING ══ -->
<div id="screen-onboard" class="screen">
  <div class="ob-wrap">
    <div class="ob-logo">Sun<span>Hash</span></div>
    <div class="ob-header">
      <div class="ob-step">One-time setup</div>
      <h2>Tell us about yourself</h2>
      <p>30 seconds. Personalises your reports and dashboard.</p>
    </div>
    <div class="ob-card">
      <div class="field"><label>Full name</label><input type="text" id="ob-name" placeholder="Alessandro Rossi"/></div>
      <div class="field"><label>Company name</label><input type="text" id="ob-company" placeholder="Helios Energy Srl"/></div>
      <div class="field">
        <label>Your role</label>
        <select id="ob-role">
          <option value="" disabled selected>Select role…</option>
          <option>Developer / Project Owner</option>
          <option>Investor / Lender</option>
          <option>EPC Contractor</option>
          <option>Independent Engineer</option>
          <option>Legal Counsel</option>
          <option>Financial Advisor</option>
          <option>Other</option>
        </select>
      </div>
      <div class="field">
        <label>Country</label>
        <select id="ob-country">
          <option value="" disabled selected>Select country…</option>
          <optgroup label="Europe"><option>Italy</option><option>Spain</option><option>France</option><option>Germany</option><option>United Kingdom</option><option>Portugal</option><option>Netherlands</option><option>Poland</option><option>Greece</option><option>Romania</option><option>Other Europe</option></optgroup>
          <optgroup label="Americas"><option>United States</option><option>Canada</option><option>Brazil</option><option>Mexico</option><option>Chile</option><option>Other Americas</option></optgroup>
          <optgroup label="Middle East &amp; Africa"><option>UAE</option><option>Saudi Arabia</option><option>South Africa</option><option>Other MEA</option></optgroup>
          <optgroup label="Asia Pacific"><option>Australia</option><option>India</option><option>Japan</option><option>Other APAC</option></optgroup>
        </select>
      </div>
      <button class="btn-primary" id="btn-ob" onclick="saveProfile()" style="margin-top:8px;">Go to My Dashboard →</button>
      <div class="msg" id="ob-msg"></div>
    </div>
    <div class="ob-note">Your data is encrypted and never shared with third parties.</div>
  </div>
</div>

<script>
// ── CONFIG — replace with your real values ────────────────────
const SUPABASE_URL  = https://pyetvugwochlqdxjchwp.supabase.co;
const SUPABASE_KEY  = sb_publishable_wcO7yhermAiLYrltUILrlw_thJ-I-de;
// ─────────────────────────────────────────────────────────────

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ── SCREEN SWITCHER ───────────────────────────────────────────
function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('visible'));
  const el = document.getElementById(id);
  if (el) el.classList.add('visible');
}

// ── TAB SWITCHER ─────────────────────────────────────────────
function switchTab(tab) {
  document.getElementById('form-login').style.display  = tab === 'login'  ? 'block' : 'none';
  document.getElementById('form-signup').style.display = tab === 'signup' ? 'block' : 'none';
  document.getElementById('form-reset').style.display  = tab === 'reset'  ? 'block' : 'none';
  document.getElementById('tab-li').classList.toggle('active', tab === 'login');
  document.getElementById('tab-su').classList.toggle('active', tab === 'signup');
}

// ── MESSAGES ─────────────────────────────────────────────────
function setMsg(id, text, type) {
  const el = document.getElementById(id);
  if (!el) return;
  el.textContent = text;
  el.className = 'msg ' + (type || '');
}

// ── GOOGLE AUTH ───────────────────────────────────────────────
async function authGoogle() {
  const base = window.location.href.replace(/\/[^/]*$/, '/');
  const { error } = await sb.auth.signInWithOAuth({
    provider: 'google',
    options: { redirectTo: base + 'dashboard.html' }
  });
  if (error) alert(error.message);
}

// ── EMAIL LOGIN ───────────────────────────────────────────────
async function doLogin() {
  const btn = document.getElementById('btn-li');
  btn.disabled = true; btn.textContent = 'Signing in…';
  const { error } = await sb.auth.signInWithPassword({
    email:    document.getElementById('li-email').value.trim(),
    password: document.getElementById('li-pw').value,
  });
  btn.disabled = false; btn.textContent = 'Sign In →';
  if (error) { setMsg('li-msg', error.message, 'err'); return; }
  window.location.href = 'dashboard.html';
}

// ── SIGN UP ───────────────────────────────────────────────────
async function doSignup() {
  const btn = document.getElementById('btn-su');
  btn.disabled = true; btn.textContent = 'Creating account…';
  const email = document.getElementById('su-email').value.trim();
  const pw    = document.getElementById('su-pw').value;
  if (pw.length < 8) {
    setMsg('su-msg', 'Password must be at least 8 characters.', 'err');
    btn.disabled = false; btn.textContent = 'Create Account →';
    return;
  }
  const { data, error } = await sb.auth.signUp({ email, password: pw });
  btn.disabled = false; btn.textContent = 'Create Account →';
  if (error) { setMsg('su-msg', error.message, 'err'); return; }
  // If email confirmation is required, user will be null
  if (!data.user) {
    setMsg('su-msg', 'Check your email to confirm your account, then sign in.', 'ok');
    return;
  }
  show('screen-onboard');
}

// ── PASSWORD RESET ────────────────────────────────────────────
async function doReset() {
  const email = document.getElementById('rs-email').value.trim();
  const base  = window.location.href.replace(/\/[^/]*$/, '/');
  const { error } = await sb.auth.resetPasswordForEmail(email, {
    redirectTo: base + 'profile.html'
  });
  if (error) { setMsg('rs-msg', error.message, 'err'); return; }
  setMsg('rs-msg', 'Reset link sent — check your inbox.', 'ok');
}

// ── ONBOARDING SAVE ───────────────────────────────────────────
async function saveProfile() {
  const btn = document.getElementById('btn-ob');
  btn.disabled = true; btn.textContent = 'Saving…';
  const { data: { user } } = await sb.auth.getUser();
  if (!user) { window.location.href = 'index.html'; return; }
  const { error } = await sb.from('profiles').upsert({
    id:        user.id,
    full_name: document.getElementById('ob-name').value,
    company:   document.getElementById('ob-company').value,
    role:      document.getElementById('ob-role').value,
    country:   document.getElementById('ob-country').value,
  });
  btn.disabled = false; btn.textContent = 'Go to My Dashboard →';
  if (error) { setMsg('ob-msg', error.message, 'err'); return; }
  window.location.href = 'dashboard.html';
}

// ── INIT: runs after DOM is fully parsed ─────────────────────
document.addEventListener('DOMContentLoaded', async () => {
  // Default: show the auth screen immediately, no loading state
  show('screen-auth');

  // Then silently check if user is already logged in
  try {
    const { data: { session } } = await sb.auth.getSession();
    if (!session) return; // not logged in — stay on auth screen

    // Logged in — check if onboarding is done
    const { data: profile } = await sb.from('profiles')
      .select('full_name')
      .eq('id', session.user.id)
      .single();

    if (profile?.full_name) {
      window.location.href = 'dashboard.html';
    } else {
      show('screen-onboard');
    }
  } catch (err) {
    // Network error or bad credentials — stay on auth screen
    console.warn('Auth check failed:', err.message);
  }
});

// ── ENTER KEY SUPPORT ────────────────────────────────────────
document.addEventListener('keydown', e => {
  if (e.key !== 'Enter') return;
  if (document.getElementById('form-login')?.style.display !== 'none') doLogin();
  else if (document.getElementById('form-signup')?.style.display !== 'none') doSignup();
});
</script>
</body>
</html>
