<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>SunHash — Sign In</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{--bg:#E4E4E0;--black:#111111;--yellow:#DDFF00;--white:#F0F0EC;--gray-lt:#D4D4D0;--gray:#B8B8B4;--gray-dk:#888884;--red:#E83535;--fh:'Barlow Condensed',sans-serif;--fb:'Barlow',sans-serif;--bk:2px solid #111111;}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{font-family:var(--fb);background:var(--bg);color:var(--black);min-height:100vh;display:grid;grid-template-columns:1fr 1fr;-webkit-font-smoothing:antialiased;}
@media(max-width:768px){body{grid-template-columns:1fr;}}
a{text-decoration:none;}

/* LEFT PANEL */
.left{background:var(--black);display:flex;flex-direction:column;justify-content:center;padding:60px 56px;min-height:100vh;}
@media(max-width:768px){.left{padding:40px 24px;min-height:auto;}}
.logo{font-family:var(--fh);font-size:24px;font-weight:900;letter-spacing:2px;text-transform:uppercase;color:var(--white);margin-bottom:48px;display:block;}
.logo span{color:var(--yellow);}
.panel-eyebrow{font-family:var(--fh);font-size:11px;font-weight:700;letter-spacing:4px;text-transform:uppercase;color:var(--yellow);margin-bottom:12px;}
.panel-title{font-family:var(--fh);font-size:clamp(36px,4vw,52px);font-weight:900;text-transform:uppercase;letter-spacing:-1px;line-height:.95;color:var(--white);margin-bottom:40px;}

/* FORM */
.form-box{background:var(--white);border:var(--bk);padding:36px;}
.field{margin-bottom:18px;}
.field label{display:block;font-family:var(--fh);font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--gray-dk);margin-bottom:7px;}
.field input{width:100%;padding:12px 14px;background:var(--bg);border:var(--bk);font-family:var(--fb);font-size:15px;color:var(--black);outline:none;}
.field input::placeholder{color:var(--gray);}
.field input:focus{box-shadow:3px 3px 0 var(--yellow);}
.btn-google{width:100%;padding:13px;background:#111;border:var(--bk);color:var(--white);font-family:var(--fh);font-size:14px;font-weight:800;letter-spacing:2px;text-transform:uppercase;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:20px;transition:all .15s;}
.btn-google:hover{background:var(--yellow);color:var(--black);}
.btn-google svg{width:18px;height:18px;flex-shrink:0;}
.or{text-align:center;font-family:var(--fh);font-size:11px;font-weight:700;letter-spacing:2px;color:var(--gray);margin:0 0 20px;}
.btn-submit{width:100%;padding:15px;background:var(--yellow);border:var(--bk);color:var(--black);font-family:var(--fh);font-size:16px;font-weight:900;letter-spacing:3px;text-transform:uppercase;cursor:pointer;margin-top:4px;transition:all .15s;}
.btn-submit:hover{background:var(--black);color:var(--yellow);}
.btn-submit:disabled{opacity:.4;cursor:not-allowed;}
.msg{min-height:20px;margin-top:12px;font-size:13px;font-weight:600;}
.msg.err{color:var(--red);}
.msg.ok{color:#22883a;}
.form-links{display:flex;justify-content:space-between;align-items:center;margin-top:20px;flex-wrap:wrap;gap:8px;}
.form-links a,.form-links button{font-size:13px;color:var(--gray-dk);background:none;border:none;cursor:pointer;padding:0;}
.form-links a:hover,.form-links button:hover{color:var(--black);}

/* RIGHT PANEL */
.right{background:var(--bg);display:flex;flex-direction:column;justify-content:center;padding:60px 56px;border-left:var(--bk);}
@media(max-width:768px){.right{display:none;}}
.right-tag{font-family:var(--fh);font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;background:var(--black);color:var(--yellow);display:inline-block;padding:4px 10px;margin-bottom:20px;}
.right h3{font-family:var(--fh);font-size:32px;font-weight:900;text-transform:uppercase;letter-spacing:-1px;margin-bottom:32px;}
.feat{display:flex;gap:16px;padding:18px 0;border-bottom:var(--bk);}
.feat:last-child{border-bottom:none;}
.feat-num{font-family:var(--fh);font-size:28px;font-weight:900;color:var(--yellow);width:36px;flex-shrink:0;line-height:1;}
.feat-text h4{font-family:var(--fh);font-size:15px;font-weight:800;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;}
.feat-text p{font-size:13px;color:var(--gray-dk);line-height:1.6;}

/* Reset form (hidden by default) */
#reset-box{display:none;}
</style>
</head>
<body>

<div class="left">
  <a href="index.html" class="logo">Sun<span>Hash</span></a>
  <div class="panel-eyebrow">Welcome back</div>
  <div class="panel-title">Sign in to your account</div>

  <!-- LOGIN FORM -->
  <div id="login-box" class="form-box">
    <button class="btn-google" id="btn-google" onclick="authGoogle.call(this, event)">
      <svg viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
      Continue with Google
    </button>
    <div class="or">OR</div>
    <div class="field"><label>Email</label><input type="email" id="li-email" placeholder="you@company.com" autocomplete="email"/></div>
    <div class="field"><label>Password</label><input type="password" id="li-pw" placeholder="••••••••" autocomplete="current-password"/></div>
    <button class="btn-submit" id="btn-li" onclick="doLogin()">Sign In →</button>
    <div class="msg" id="li-msg"></div>
    <div class="form-links">
      <a href="signup.html">No account? Create one →</a>
      <button onclick="showReset()">Forgot password?</button>
    </div>
  </div>

  <!-- RESET FORM -->
  <div id="reset-box" class="form-box">
    <p style="font-size:14px;color:var(--gray-dk);line-height:1.6;margin-bottom:20px;">Enter your email and we'll send you a password reset link.</p>
    <div class="field"><label>Email</label><input type="email" id="rs-email" placeholder="you@company.com"/></div>
    <button class="btn-submit" onclick="doReset()">Send Reset Link →</button>
    <div class="msg" id="rs-msg"></div>
    <div class="form-links">
      <button onclick="showLogin()">← Back to sign in</button>
    </div>
  </div>
</div>

<div class="right">
  <div class="right-tag">Why SunHash</div>
  <h3>Risk intelligence<br>for solar developers</h3>
  <div class="feat"><div class="feat-num">181</div><div class="feat-text"><h4>Diagnostic questions</h4><p>Engineering-grade questions across six risk categories. Designed so knowledge gaps reveal themselves.</p></div></div>
  <div class="feat"><div class="feat-num">~5</div><div class="feat-text"><h4>Minutes to your report</h4><p>Submit answers, receive a scored PDF with critical issues, action plan, and data gaps immediately.</p></div></div>
  <div class="feat"><div class="feat-num">3</div><div class="feat-text"><h4>External contributors</h4><p>Invite your EPC, engineer, or lender to fill their section. Each response updates your score automatically.</p></div></div>
</div>

<script>
// ── CONFIG ────────────────────────────────────────────────────
const SUPABASE_URL  = https://pyetvugwochlqdxjchwp.supabase.co;
const SUPABASE_KEY  = sb_publishable_wcO7yhermAiLYrltUILrlw_thJ-I-de;
// ─────────────────────────────────────────────────────────────
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

function showReset() {
  document.getElementById('login-box').style.display = 'none';
  document.getElementById('reset-box').style.display = 'block';
}
function showLogin() {
  document.getElementById('login-box').style.display = 'block';
  document.getElementById('reset-box').style.display = 'none';
}
function setMsg(id, text, type) {
  const el = document.getElementById(id);
  el.textContent = text;
  el.className = 'msg ' + (type || '');
}

async function authGoogle() {
  // Show feedback immediately so user knows something is happening
  const btn = this;
  btn.textContent = 'Connecting…';
  btn.disabled = true;

  try {
    // Build absolute redirect URL — required for OAuth to work
    const base = window.location.origin +
      window.location.pathname.replace(/[^/]*$/, '');
    const redirectTo = base + 'dashboard.html';

    const { error } = await sb.auth.signInWithOAuth({
      provider: 'google',
      options: { redirectTo }
    });

    if (error) {
      setMsg('li-msg', 'Google sign-in error: ' + error.message, 'err');
      btn.innerHTML = googleIconHTML + ' Continue with Google';
      btn.disabled = false;
    }
    // If no error, the page will redirect to Google — no need to reset button
  } catch (e) {
    setMsg('li-msg', 'Error: ' + e.message + ' — check your Supabase credentials.', 'err');
    btn.innerHTML = googleIconHTML + ' Continue with Google';
    btn.disabled = false;
  }
}

const googleIconHTML = `<svg viewBox="0 0 24 24" width="18" height="18"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>`;

async function doLogin() {
  const btn = document.getElementById('btn-li');
  btn.disabled = true; btn.textContent = 'Signing in…';
  const { error } = await sb.auth.signInWithPassword({
    email:    document.getElementById('li-email').value.trim(),
    password: document.getElementById('li-pw').value,
  });
  btn.disabled = false; btn.textContent = 'Sign In →';
  if (error) { setMsg('li-msg', error.message, 'err'); return; }
  window.location.href = 'dashboard.html';
}

async function doReset() {
  const base = window.location.href.replace(/\/[^/]*$/, '/');
  const { error } = await sb.auth.resetPasswordForEmail(
    document.getElementById('rs-email').value.trim(),
    { redirectTo: base + 'profile.html' }
  );
  if (error) { setMsg('rs-msg', error.message, 'err'); return; }
  setMsg('rs-msg', 'Reset link sent — check your inbox.', 'ok');
}

// Startup: validate credentials, then check for existing session
document.addEventListener('DOMContentLoaded', async () => {
  try {
    const { data: { session }, error } = await sb.auth.getSession();
    if (error) {
      setMsg('li-msg', 'Supabase connection error: ' + error.message, 'err');
      return;
    }
    if (session) window.location.href = 'dashboard.html';
  } catch(e) {
    setMsg('li-msg', 'Cannot connect to Supabase — check your URL and API key in the CONFIG block.', 'err');
  }
});

document.addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});
</script>
</body>
</html>
